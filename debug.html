<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debug - Live TV</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #1a1a1a;
      color: #fff;
    }
    .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
    .success { background: #22c55e; }
    .error { background: #ef4444; }
    .warning { background: #f59e0b; }
    .info { background: #3b82f6; }
    pre { background: #2a2a2a; padding: 15px; border-radius: 5px; overflow-x: auto; }
    button { padding: 10px 20px; margin: 5px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>üîç Live TV Deployment Debugger</h1>
  
  <div id="results"></div>
  
  <h2>Manual Tests</h2>
  <button onclick="testJSON()">Test JSON Loading</button>
  <button onclick="testHTTPS()">Check HTTPS Status</button>
  <button onclick="testPaths()">Test Asset Paths</button>
  
  <script>
    const results = document.getElementById('results');
    
    function log(message, type = 'info') {
      const div = document.createElement('div');
      div.className = `status ${type}`;
      div.textContent = message;
      results.appendChild(div);
    }
    
    // Auto-run tests on load
    window.onload = async () => {
      log('üöÄ Starting diagnostic tests...', 'info');
      
      // Test 1: Check protocol
      const protocol = window.location.protocol;
      log(`Protocol: ${protocol}`, protocol === 'https:' ? 'warning' : 'success');
      
      if (protocol === 'https:') {
        log('‚ö†Ô∏è HTTPS detected: HTTP streams will be blocked!', 'error');
      }
      
      // Test 2: Try to load JSON
      try {
        log('Testing JSON load from /assets/data/channels.json...', 'info');
        const response = await fetch('/assets/data/channels.json');
        
        if (response.ok) {
          const data = await response.json();
          log('‚úÖ JSON loaded successfully!', 'success');
          log(`Categories found: ${Object.keys(data.categories).join(', ')}`, 'success');
          
          // Test 3: Check stream URLs
          let httpCount = 0;
          let httpsCount = 0;
          let emptyCount = 0;
          
          Object.values(data.categories).forEach(cat => {
            cat.channels.forEach(ch => {
              if (!ch.url || ch.url === '') emptyCount++;
              else if (ch.url.startsWith('http://')) httpCount++;
              else if (ch.url.startsWith('https://')) httpsCount++;
            });
          });
          
          log(`Stream URL Analysis:`, 'info');
          log(`  - HTTP streams: ${httpCount}`, httpCount > 0 && protocol === 'https:' ? 'error' : 'warning');
          log(`  - HTTPS streams: ${httpsCount}`, httpsCount > 0 ? 'success' : 'warning');
          log(`  - Empty/Coming soon: ${emptyCount}`, 'info');
          
          if (httpCount > 0 && protocol === 'https:') {
            log('‚ùå CRITICAL: HTTP streams detected on HTTPS site!', 'error');
            log('üëâ Solution: Replace HTTP streams with HTTPS versions', 'warning');
          }
          
          // Display sample data
          const pre = document.createElement('pre');
          pre.textContent = JSON.stringify(data, null, 2).substring(0, 500) + '...';
          results.appendChild(pre);
          
        } else {
          log(`‚ùå Failed to load JSON: ${response.status} ${response.statusText}`, 'error');
        }
      } catch (error) {
        log(`‚ùå Error loading JSON: ${error.message}`, 'error');
        
        // Try alternative path
        try {
          log('Trying alternative path: ./assets/data/channels.json', 'info');
          const response2 = await fetch('./assets/data/channels.json');
          if (response2.ok) {
            log('‚úÖ Alternative path works!', 'success');
          }
        } catch (error2) {
          log(`‚ùå Alternative path also failed: ${error2.message}`, 'error');
        }
      }
      
      // Test 4: Check HLS.js
      if (typeof Hls !== 'undefined') {
        log('‚úÖ HLS.js is loaded', 'success');
        log(`HLS.js supported: ${Hls.isSupported()}`, Hls.isSupported() ? 'success' : 'error');
      } else {
        log('‚ùå HLS.js not found!', 'error');
      }
      
      log('üèÅ Diagnostic tests complete!', 'info');
    };
    
    function testJSON() {
      window.location.href = '/assets/data/channels.json';
    }
    
    function testHTTPS() {
      alert(`Current Protocol: ${window.location.protocol}\nFull URL: ${window.location.href}`);
    }
    
    function testPaths() {
      const paths = [
        '/assets/data/channels.json',
        './assets/data/channels.json',
        'assets/data/channels.json'
      ];
      
      log('Testing multiple paths...', 'info');
      
      paths.forEach(async (path) => {
        try {
          const response = await fetch(path);
          log(`${path}: ${response.ok ? '‚úÖ OK' : '‚ùå Failed'}`, response.ok ? 'success' : 'error');
        } catch (error) {
          log(`${path}: ‚ùå ${error.message}`, 'error');
        }
      });
    }
  </script>
  
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</body>
</html>
